<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Integral Calculator – Nguyên Hàm</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- MathJax -->
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: radial-gradient(circle at top, #111827, #000000);
      color: #e5e7eb;
    }
    header {
      text-align: center;
      padding: 30px 20px;
    }
    header h1 {
      font-size: 2.5rem;
      font-weight: 700;
    }
    .container {
      max-width: 1100px;
      margin: auto;
      padding: 20px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }
    .card {
      background: rgba(31, 41, 55, 0.9);
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.4);
    }
    .card h2 {
      margin-top: 0;
      font-size: 1.4rem;
    }
    input {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: none;
      font-size: 1rem;
      margin-bottom: 10px;
    }
    button {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: none;
      background: linear-gradient(135deg, #6366f1, #22d3ee);
      color: black;
      font-weight: 600;
      font-size: 1rem;
      cursor: pointer;
    }
    button:hover {
      opacity: 0.9;
    }
    .result {
      margin-top: 15px;
      background: rgba(0,0,0,0.4);
      padding: 12px;
      border-radius: 10px;
    }
    .formula-section h3 {
      margin-bottom: 5px;
      margin-top: 15px;
      color: #93c5fd;
    }
    ul {
      padding-left: 18px;
    }
    footer {
      text-align: center;
      padding: 20px;
      font-size: 0.85rem;
      color: #9ca3af;
    }
  </style>
</head>
<body>

<header>
  <h1>∫ Integral Calculator</h1>
  <p>Công cụ học thuật tính nguyên hàm</p>
</header>

<div class="container">

  <!-- Calculator -->
  <div class="card">
    <h2>Tính nguyên hàm</h2>
    <input id="expr" placeholder="Ví dụ: x^2, 1/x, sin(x), e^x" />
    <button onclick="calculate()">Tính ∫ dx</button>
    <div id="output" class="result"></div>
  </div>

  <!-- Formula table -->
  <div class="card">
    <h2>Bảng công thức nguyên hàm</h2>

    <div class="formula-section">
      <h3>Cơ bản</h3>
      <ul>
        <li>\(\int k\,dx = kx + C\)</li>
        <li>\(\int x^n dx = \frac{x^{n+1}}{n+1} + C,\; n \neq -1\)</li>
        <li>\(\int \frac{1}{x}dx = \ln|x| + C\)</li>
      </ul>
    </div>

    <div class="formula-section">
      <h3>Mũ & Log</h3>
      <ul>
        <li>\(\int e^x dx = e^x + C\)</li>
        <li>\(\int a^x dx = \frac{a^x}{\ln a} + C\)</li>
        <li>\(\int \ln x dx = x\ln x - x + C\)</li>
      </ul>
    </div>

    <div class="formula-section">
      <h3>Lượng giác</h3>
      <ul>
        <li>\(\int \sin x dx = -\cos x + C\)</li>
        <li>\(\int \cos x dx = \sin x + C\)</li> 
      </ul>
    </div>

    <div class="formula-section">
      <h3>Nâng cao</h3>
      <ul>
        <li>\(\int \frac{f'(x)}{f(x)}dx = \ln|f(x)| + C\)</li>
        <li>\(\int u\,dv = uv - \int v\,du\)</li>
      </ul>
    </div>

  </div>
</div>

<footer>
  Thiết kế học thuật • Math UI • HTML thuần
</footer>

<script>
/***********************
 * TOKENIZER
 ***********************/
function tokenize(input) {
  const regex = /\s*(sin|cos|ln|e|x|\d+\.?\d*|\+|\-|\*|\/|\^|\(|\))\s*/g;
  let tokens = [];
  let m;
  while ((m = regex.exec(input)) !== null) {
    tokens.push(m[1]);
  }
  return tokens;
}

/***********************
 * PARSER (AST)
 ***********************/
function parse(tokens) {
  let pos = 0;

  function peek() { return tokens[pos]; }
  function next() { return tokens[pos++]; }

  function parsePrimary() {
    const t = next();

    if (t === 'x') return { type: 'var' };
    if (!isNaN(t)) return { type: 'num', value: Number(t) };
    if (t === 'e') return { type: 'const', name: 'e' };

    if (t === 'sin' || t === 'cos' || t === 'ln') {
      next(); // (
      const arg = parseExpr();
      next(); // )
      return { type: 'func', name: t, arg };
    }

    if (t === '(') {
      const e = parseExpr();
      next(); // )
      return e;
    }
  }

  function parsePower() {
    let node = parsePrimary();
    if (peek() === '^') {
      next();
      node = { type: 'pow', base: node, exp: parsePrimary() };
    }
    return node;
  }

  function parseTerm() {
    let node = parsePower();
    while (peek() === '*' || peek() === '/') {
      node = { type: 'bin', op: next(), left: node, right: parsePower() };
    }
    return node;
  }

  function parseExpr() {
    let node = parseTerm();
    while (peek() === '+' || peek() === '-') {
      node = { type: 'bin', op: next(), left: node, right: parseTerm() };
    }
    return node;
  }

  return parseExpr();
}

/***********************
 * INTEGRATOR + STEPS
 ***********************/
function integrate(node, steps) {

  if (node.type === 'var') {
    steps.push("Áp dụng: ∫x dx = x²/2");
    return "x^2/2";
  }

  if (node.type === 'num') {
    steps.push(`Áp dụng: ∫${node.value} dx = ${node.value}x`);
    return `${node.value}x`;
  }

  if (node.type === 'pow' && node.base.type === 'var' && node.exp.type === 'num') {
    const n = node.exp.value;
    steps.push(`Áp dụng công thức: ∫x^${n} dx = x^{${n+1}}/${n+1}`);
    return `x^${n+1}/${n+1}`;
  }

  if (node.type === 'pow' && node.base.type === 'const' && node.base.name === 'e') {
    steps.push("Áp dụng: ∫e^x dx = e^x");
    return "e^x";
  }

  if (node.type === 'func' && node.name === 'sin') {
    steps.push("Áp dụng: ∫sin(x) dx = -cos(x)");
    return "-cos(x)";
  }

  if (node.type === 'func' && node.name === 'cos') {
    steps.push("Áp dụng: ∫cos(x) dx = sin(x)");
    return "sin(x)";
  }

  if (node.type === 'func' && node.name === 'ln') {
    steps.push("Áp dụng: ∫ln(x) dx = x ln x − x");
    return "x ln x - x";
  }

  steps.push("❌ Chưa hỗ trợ dạng này");
  return "?";
}
function calculate() {
  const expr = document.getElementById('expr').value.replace(/\s+/g, '');
  let result = '';

  // x
  if (expr === 'x') {
    result = 'x^2/2 + C';
  }

  // 1/x
  else if (expr === '1/x') {
    result = 'ln|x| + C';
  }

  // e^x
  else if (expr === 'e^x') {
    result = 'e^x + C';
  }

  // sin, cos
  else if (expr === 'sin(x)') {
    result = '-cos(x) + C';
  }
  else if (expr === 'cos(x)') {
    result = 'sin(x) + C';
  }

  // ===== SỐ HẰNG (2, 1/2, 2/1, -3, 0, ...) =====
  else if (/^-?\d+(\.\d+)?(\/\d+(\.\d+)?)?$/.test(expr)) {
    if (Number(expr) === 0) {
      result = 'C';
    } else {
      result = `${expr}x + C`;
    }
  }

  // ===== x^n =====
  else if (/^x\^\d+$/.test(expr)) {
    const n = parseInt(expr.split('^')[1]);
    result = `x^${n + 1}/${n + 1} + C`;
  }

  // ===== a^x : 2^x, 6^x, 10^x, ... =====
  else if (/^\d+(\.\d+)?\^x$/.test(expr)) {
    const a = expr.split('^')[0];
    result = `${a}^x / ln(${a}) + C`;
  }

  // ===== NOT SUPPORTED =====
  else {
    result = 'Chưa hỗ trợ nguyên hàm này (phiên bản học thuật).';
  }

  document.getElementById('output').innerHTML =
    `\\(\\int ${expr} \\, dx = ${result}\\)`;
  MathJax.typeset();
}
</script>

</body>
</html>
